<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Planejador de Tarefas</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f9fafb;
      --card: #ffffff;
      --border: #e5e7eb;
      --text: #374151;
      --text-light: #6b7280;
      --primary: #0d9488;
      --primary-hover: #0f766e;
      --danger: #dc2626;
      --danger-hover: #b91c1c;
      --danger-light: #fee2e2;
    }

    *, *::before, *::after { box-sizing: border-box; }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #ecfdf5, #cffafe);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      color: var(--text);
    }

    .container {
      max-width: 1100px;
      width: 100%;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 1rem;
      padding: 2rem;
      box-shadow: 0 8px 32px rgba(0,0,0,0.08);
    }

    h1 { text-align: center; font-size: 2rem; font-weight: 700; margin-bottom: .5rem; }
    p.subtitle { text-align: center; color: var(--text-light); margin-bottom: 2rem; }

    .main-layout {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 2rem;
      align-items: flex-start;
    }

    @media (max-width: 900px) {
      .main-layout { grid-template-columns: 1fr; }
    }

    .score-section h2 { font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; color: var(--text); }

    .tab-container {
        border: 1px solid var(--border);
        border-radius: .75rem;
        overflow: hidden;
        background-color: var(--card);
    }

    .tab-headers { display: flex; background-color: #f9fafb; }
    .tab-header {
        flex-grow: 1; padding: 1rem; text-align: center; cursor: pointer;
        font-weight: 600; color: var(--text-light);
        border-bottom: 1px solid var(--border);
        transition: all 0.2s ease-in-out;
    }
    .tab-header.active { color: var(--primary); background-color: var(--card); border-bottom-color: transparent; }
    
    .tab-content { display: none; padding: 1.5rem; }
    .tab-content.active { display: block; }
    
    /* Formul√°rio de Adi√ß√£o */
    .add-item-form {
      display: flex;
      gap: .75rem;
      margin-top: 1.5rem;
      padding: 1rem;
      background-color: #f9fafb;
      border-radius: .75rem;
    }
    .add-item-form input {
      flex-grow: 1;
      border: 1px solid var(--border);
      border-radius: .5rem;
      padding: .6rem .8rem;
      font-size: .9rem;
    }
    .add-item-form input:focus { outline: 2px solid var(--primary); border-color: transparent; }
    .add-item-form input[type="number"] { max-width: 80px; }
    .add-item-form button {
      background: var(--primary);
      color: white;
      padding: 0 1.25rem;
      border-radius: .5rem;
      font-weight: 600;
      flex-shrink: 0;
    }
    .add-item-form button:hover { background: var(--primary-hover); }

    table { width: 100%; border-collapse: collapse; table-layout: fixed; }
    th, td { padding: .75rem 1rem; border-bottom: 1px solid var(--border); font-size: .9rem; text-align: center; vertical-align: middle; }
    th { background: #f3f4f6; color: var(--text-light); font-weight: 600; font-size: .85rem; text-transform: uppercase; }
    td:first-child { text-align: left; font-weight: 500; word-break: break-word; }
    tr:last-child td { border-bottom: none; }
    
    /* Estilos espec√≠ficos da Tabela de Tarefas para ajuste de colunas */
    #tasks th:nth-child(n+2):nth-child(-n+8),
    #tasks td:nth-child(n+2):nth-child(-n+8) {
        width: 45px;
        padding-left: .5rem;
        padding-right: .5rem;
    }
    #tasks th:nth-child(9),
    #tasks td:nth-child(9) {
        width: 65px;
    }
    #tasks th:last-child,
    #tasks td:last-child {
        width: 50px;
    }

    .task-checkbox {
      appearance: none; width: 22px; height: 22px;
      border: 2px solid var(--border); border-radius: .4rem;
      cursor: pointer; transition: all .2s; vertical-align: middle;
    }
    .task-checkbox:checked {
      background-color: var(--primary); border-color: var(--primary);
      background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.2 4.8a1 1 0 0 1 0 1.4l-5 5a1 1 0 0 1-1.4 0l-2-2a1 1 0 0 1 1.4-1.4L6.5 9.1l4.3-4.3a1 1 0 0 1 1.4 0z'/%3e%3c/svg%3e");
      background-size: 100% 100%; background-position: center;
    }

    button { border: none; cursor: pointer; border-radius: .5rem; transition: all .2s; font-weight: 600; }
    .btn-primary { background: var(--primary); color: white; padding: .75rem 1.25rem; width: 100%; margin-top: 1rem; }
    .btn-primary:hover { background: var(--primary-hover); }
    .btn-circle { width: 28px; height: 28px; display: inline-flex; align-items: center; justify-content: center; font-weight: bold; border-radius: 50%; font-size: 1rem; margin: 0 5px; }
    .btn-plus { background: var(--primary); color: white; } .btn-plus:hover { background: var(--primary-hover); }
    .btn-minus { background: var(--danger-light); color: var(--danger); } .btn-minus:hover { background: #fecaca; }
    .btn-delete {
      background: transparent; color: #9ca3af;
      padding: 0; width: 28px; height: 28px;
      border-radius: 50%;
    }
    .btn-delete:hover { background: var(--danger-light); color: var(--danger); }

    .score-card { background: #f3f4f6; border: 1px solid var(--border); padding: 1.5rem; border-radius: .75rem; display: flex; flex-direction: column; gap: 1rem; }
    .score-row { display: flex; justify-content: space-between; align-items: center; }
    .score-main { font-size: 1.5rem; font-weight: 700; padding: .25rem .75rem; border-radius: .5rem; }
    .score-positive { color: var(--primary); background: #ccfbf1; }
    .score-negative { color: var(--danger); background: #fee2e2; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Planejador de Tarefas</h1>
    <p class="subtitle">Transforme sua rotina em um jogo e conquiste suas metas.</p>

    <div class="main-layout">
      <div class="tab-container">
        <div class="tab-headers">
          <div class="tab-header active" data-tab="tasks">üìã Tarefas</div>
          <div class="tab-header" data-tab="rewards">üéÅ Recompensas</div>
        </div>
        
        <div id="tasks" class="tab-content active">
          <table>
            <thead>
              <tr>
                <th>Nome</th>
                <th>Seg</th><th>Ter</th><th>Qua</th><th>Qui</th><th>Sex</th><th>S√°b</th><th>Dom</th>
                <th>Pts</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="tasks-table-body"></tbody>
          </table>
          <form class="add-item-form" id="add-task-form">
            <input type="text" id="new-task-name" placeholder="Nome da nova tarefa" required>
            <input type="number" id="new-task-points" placeholder="Pontos" required min="1">
            <button type="submit">Adicionar</button>
          </form>
        </div>
        
        <div id="rewards" class="tab-content">
          <table>
            <thead><tr><th>Nome</th><th>Pontos</th><th>Qtd</th><th></th></tr></thead>
            <tbody id="rewards-table-body"></tbody>
          </table>
          <form class="add-item-form" id="add-reward-form">
            <input type="text" id="new-reward-name" placeholder="Nome da nova recompensa" required>
            <input type="number" id="new-reward-points" placeholder="Pontos" required min="1">
            <button type="submit">Adicionar</button>
          </form>
        </div>
      </div>

      <div class="score-section">
        <h2>‚≠ê Pontua√ß√£o</h2>
        <div class="score-card">
          <div class="score-row"><span>Saldo Anterior</span><span id="saldo-anterior">0</span></div>
          <div class="score-row"><strong>Pontos da Semana</strong><span id="pontos-semana">+0</span></div>
          <hr style="border-color: var(--border); border-style: dashed;">
          <div class="score-row">
            <strong>Pontos Acumulados</strong>
            <span id="pontos-acumulados" class="score-main score-positive">0</span>
          </div>
          <button id="reset-button" class="btn-primary">Fechar Semana e Salvar Pontos</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // --- Estado da Aplica√ß√£o ---
    let tasks = [];
    let rewards = [];
    let saldoAnterior = 0;
    let taskChecks = {};

    // --- Dados Iniciais (Fallback) ---
    const initialTasks = [
        { "name": "Meditar", "points": 100 },
        { "name": "Ler livro", "points": 100 },
        { "name": "Estudar Ingl√™s", "points": 100 },
        { "name": "Fazer exerc√≠cio", "points": 100 },
        { "name": "Estudar Programa√ß√£o", "points": 200 }
    ];

    const initialRewards = [
        { "name": "Pizza", "points": 3000 },
        { "name": "Hamb√∫rguer", "points": 3000 },
        { "name": "Jogar video game (1h)", "points": 400 },
        { "name": "Assistir um filme", "points": 400 }
    ];
    
    // --- Persist√™ncia de Dados ---
    function saveState() {
      localStorage.setItem("plannerState", JSON.stringify({ saldoAnterior, tasks, rewards, taskChecks }));
    }

    function loadState() {
      const saved = localStorage.getItem("plannerState");
      if (saved) {
        const state = JSON.parse(saved);
        saldoAnterior = state.saldoAnterior || 0;
        tasks = state.tasks || initialTasks;
        rewards = state.rewards || initialRewards;
        taskChecks = state.taskChecks || {};
      } else {
        tasks = initialTasks;
        rewards = initialRewards;
      }
    }

    // --- Fun√ß√µes de Renderiza√ß√£o ---
    function renderTasks() {
      const tbody = document.getElementById("tasks-table-body");
      tbody.innerHTML = "";
      tasks.forEach((task, taskIndex) => {
        const tr = document.createElement("tr");
        tr.dataset.index = taskIndex;
        let cells = `<td class="task-name">${task.name}</td>`;
        for (let day = 0; day < 7; day++) {
          const checkId = `task-${taskIndex}-${day}`;
          const checked = taskChecks[checkId] ? "checked" : "";
          cells += `<td><input type="checkbox" class="task-checkbox" data-id="${checkId}" ${checked}></td>`;
        }
        cells += `<td>${task.points}</td>`;
        cells += `<td><button class="btn-delete delete-task" title="Excluir tarefa">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/><path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/></svg>
                  </button></td>`;
        tr.innerHTML = cells;
        tbody.appendChild(tr);
      });
    }

    function renderRewards() {
      const tbody = document.getElementById("rewards-table-body");
      tbody.innerHTML = "";
      rewards.forEach((reward, rewardIndex) => {
        if (reward.quantity === undefined) reward.quantity = 0;
        const tr = document.createElement("tr");
        tr.dataset.index = rewardIndex;
        tr.innerHTML = `
          <td>${reward.name}</td>
          <td>${reward.points}</td>
          <td>
            <button class="btn-circle btn-minus" aria-label="Remover ${reward.name}">‚àí</button>
            <span class="reward-qty" style="display: inline-block; width: 25px; text-align: center;">${reward.quantity}</span>
            <button class="btn-circle btn-plus" aria-label="Adicionar ${reward.name}">+</button>
          </td>
          <td><button class="btn-delete delete-reward" title="Excluir recompensa">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/><path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/></svg>
          </button></td>
        `;
        tbody.appendChild(tr);
      });
    }
    
    // --- Fun√ß√µes de L√≥gica e C√°lculo ---
    function calculateWeeklyPoints() {
      let pontosGanhos = 0;
      Object.keys(taskChecks).forEach(checkId => {
          if(taskChecks[checkId]) {
              const [_, taskIndexStr] = checkId.split('-');
              const taskIndex = parseInt(taskIndexStr, 10);
              if(tasks[taskIndex]) {
                  pontosGanhos += tasks[taskIndex].points;
              }
          }
      });
      return pontosGanhos;
    }

    function calculateRewardsCost() {
      return rewards.reduce((total, reward) => total + (reward.quantity || 0) * reward.points, 0);
    }

    function updateScores() {
      const pontosSemana = calculateWeeklyPoints();
      const pontosRecompensas = calculateRewardsCost();
      const pontosAcumulados = saldoAnterior + pontosSemana - pontosRecompensas;

      document.getElementById("saldo-anterior").textContent = saldoAnterior;
      document.getElementById("pontos-semana").textContent = `+${pontosSemana}`;
      document.getElementById("pontos-acumulados").textContent = pontosAcumulados;
      
      const acumuladoEl = document.getElementById("pontos-acumulados");
      acumuladoEl.classList.toggle("score-negative", pontosAcumulados < 0);
      acumuladoEl.classList.toggle("score-positive", pontosAcumulados >= 0);

      saveState();
    }
    
    // --- Event Listeners ---
    document.getElementById("tasks-table-body").addEventListener('change', (e) => {
        if(e.target.classList.contains('task-checkbox')) {
            taskChecks[e.target.dataset.id] = e.target.checked;
            updateScores();
        }
    });

    document.getElementById("tasks-table-body").addEventListener('click', (e) => {
        const deleteButton = e.target.closest('.delete-task');
        if (deleteButton) {
            const tr = deleteButton.closest('tr');
            const taskIndex = parseInt(tr.dataset.index, 10);
            const taskName = tasks[taskIndex].name;
            if (confirm(`Tem certeza que deseja excluir a tarefa "${taskName}"?`)) {
              tasks.splice(taskIndex, 1);
              // Opcional: Limpar checks associados a tarefas deletadas para n√£o poluir o localStorage
              Object.keys(taskChecks).forEach(key => {
                  if (key.startsWith(`task-${taskIndex}-`)) {
                      delete taskChecks[key];
                  }
              });
              renderTasks();
              updateScores();
            }
        }
    });

    document.getElementById("rewards-table-body").addEventListener('click', (e) => {
        const target = e.target;
        const tr = target.closest('tr');
        if (!tr) return;
        
        const rewardIndex = parseInt(tr.dataset.index, 10);
        const reward = rewards[rewardIndex];

        if (target.closest('.btn-plus')) {
            const currentTotal = saldoAnterior + calculateWeeklyPoints() - calculateRewardsCost();
            if (currentTotal >= reward.points) {
                reward.quantity = (reward.quantity || 0) + 1;
            } else {
                const scoreEl = document.getElementById('pontos-acumulados');
                scoreEl.style.transform = 'scale(1.1)';
                scoreEl.style.transition = 'transform 0.1s ease';
                setTimeout(() => { scoreEl.style.transform = 'scale(1)'; }, 100);
                return;
            }
        } else if (target.closest('.btn-minus')) {
            if (reward.quantity > 0) {
                reward.quantity--;
            }
        } else if (target.closest('.delete-reward')) {
            const rewardName = rewards[rewardIndex].name;
            if (confirm(`Tem certeza que deseja excluir a recompensa "${rewardName}"?`)) {
                rewards.splice(rewardIndex, 1);
                renderRewards();
                updateScores();
            }
            return;
        }
        
        renderRewards();
        updateScores();
    });
    
    document.getElementById("add-task-form").addEventListener('submit', (e) => {
        e.preventDefault();
        const nameInput = document.getElementById('new-task-name');
        const pointsInput = document.getElementById('new-task-points');
        const name = nameInput.value.trim();
        const points = parseInt(pointsInput.value, 10);

        if (name && points > 0) {
            tasks.push({ name, points });
            renderTasks();
            updateScores();
            nameInput.value = '';
            pointsInput.value = '';
            nameInput.focus();
        }
    });

    document.getElementById("add-reward-form").addEventListener('submit', (e) => {
        e.preventDefault();
        const nameInput = document.getElementById('new-reward-name');
        const pointsInput = document.getElementById('new-reward-points');
        const name = nameInput.value.trim();
        const points = parseInt(pointsInput.value, 10);

        if (name && points > 0) {
            rewards.push({ name, points, quantity: 0 });
            renderRewards();
            updateScores();
            nameInput.value = '';
            pointsInput.value = '';
            nameInput.focus();
        }
    });

    document.getElementById("reset-button").addEventListener("click", () => {
      if (!confirm("Tem certeza que deseja fechar a semana? Esta a√ß√£o ir√° zerar suas tarefas e recompensas resgatadas, salvando o saldo final como o novo saldo inicial.")) {
        return;
      }
      saldoAnterior = saldoAnterior + calculateWeeklyPoints() - calculateRewardsCost();
      taskChecks = {};
      rewards.forEach(r => r.quantity = 0);
      
      renderTasks();
      renderRewards();
      updateScores();
    });

    document.querySelectorAll('.tab-header').forEach(header => {
        header.addEventListener('click', () => {
            const targetTab = header.dataset.tab;
            document.querySelectorAll('.tab-header').forEach(h => h.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            header.classList.add('active');
            document.getElementById(targetTab).classList.add('active');
        });
    });
    
    // --- Inicializa√ß√£o ---
    function init() {
      loadState();
      renderTasks();
      renderRewards();
      updateScores();
    }

    init();
  </script>
</body>
</html>

