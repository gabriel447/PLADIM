<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Planejador de Tarefas</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f9fafb;
      --card: #ffffff;
      --border: #e5e7eb;
      --text: #374151;
      --text-light: #6b7280;
      --primary: #0d9488;
      --primary-hover: #0f766e;
      --danger: #dc2626;
      --danger-light: #fee2e2;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #ecfdf5, #cffafe);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      color: var(--text);
    }

    .container {
      max-width: 1200px;
      width: 100%;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 1rem;
      padding: 2rem;
      box-shadow: 0 8px 24px rgba(0,0,0,0.08);
    }

    h1 { text-align: center; font-size: 2rem; font-weight: 700; margin-bottom: .5rem; }
    p.subtitle { text-align: center; color: var(--text-light); margin-bottom: 2rem; }

    .grid { display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; }
    .section { margin-bottom: 2rem; }
    h2 { font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem; display: flex; align-items: center; gap: .5rem; }

    table { width: 100%; border-collapse: collapse; border: 1px solid var(--border); border-radius: .5rem; overflow: hidden; }
    th, td { padding: .75rem 1rem; border-bottom: 1px solid var(--border); font-size: .9rem; text-align: center; }
    th { background: #f3f4f6; color: var(--text-light); font-weight: 600; font-size: .85rem; }
    td:first-child { text-align: left; font-weight: 500; }
    tr:nth-child(even) { background: #f9fafb; }

    .task-checkbox {
      appearance: none;
      width: 22px;
      height: 22px;
      border: 2px solid var(--border);
      border-radius: .4rem;
      cursor: pointer;
      transition: all .2s;
    }
    .task-checkbox:checked {
      background-color: var(--primary);
      border-color: var(--primary);
      background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.2 4.8a1 1 0 0 1 0 1.4l-5 5a1 1 0 0 1-1.4 0l-2-2a1 1 0 0 1 1.4-1.4L6.5 9.1l4.3-4.3a1 1 0 0 1 1.4 0z'/%3e%3c/svg%3e");
      background-size: 100% 100%;
      background-position: center;
    }

    button { border: none; cursor: pointer; border-radius: .5rem; transition: all .2s; font-weight: 600; }
    .btn-primary { background: var(--primary); color: white; padding: .75rem 1.25rem; width: 100%; margin-top: 1rem; }
    .btn-primary:hover { background: var(--primary-hover); }
    .btn-circle { width: 28px; height: 28px; display: inline-flex; align-items: center; justify-content: center; font-weight: bold; border-radius: 50%; font-size: 1rem; margin: 0 5px; }
    .btn-plus { background: var(--primary); color: white; } .btn-plus:hover { background: var(--primary-hover); }
    .btn-minus { background: var(--danger-light); color: var(--danger); } .btn-minus:hover { background: #fecaca; }

    .score-card { background: #f9fafb; border: 1px solid var(--border); padding: 1.5rem; border-radius: .75rem; display: flex; flex-direction: column; gap: 1rem; }
    .score-row { display: flex; justify-content: space-between; align-items: center; }
    .score-main { font-size: 1.5rem; font-weight: 700; padding: .25rem .75rem; border-radius: .5rem; }
    .score-positive { color: var(--primary); background: #ccfbf1; }
    .score-negative { color: var(--danger); background: #fee2e2; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Planejador de Tarefas</h1>
    <p class="subtitle">Transforme sua rotina em um jogo e conquiste suas metas.</p>

    <div class="grid">
      <div>
        <div class="section">
          <h2>üìã Tarefas da Semana</h2>
          <table>
            <thead>
              <tr>
                <th>Nome</th>
                <th>Seg</th><th>Ter</th><th>Qua</th><th>Qui</th><th>Sex</th><th>S√°b</th><th>Dom</th>
                <th>Pontos</th>
              </tr>
            </thead>
            <tbody id="tasks-table-body"></tbody>
          </table>
        </div>

        <div class="section">
          <h2>üéÅ Recompensas</h2>
          <table>
            <thead>
              <tr><th>Nome</th><th>Pontos</th><th>Qtd</th></tr>
            </thead>
            <tbody id="rewards-table-body"></tbody>
          </table>
        </div>
      </div>

      <div>
        <h2>‚≠ê Pontua√ß√£o</h2>
        <div class="score-card">
          <div class="score-row"><span>Saldo Anterior</span><span id="saldo-anterior">0</span></div>
          <div class="score-row"><strong>Pontos da Semana</strong><span id="pontos-semana">+0</span></div>
          <hr>
          <div class="score-row">
            <strong>Pontos Acumulados</strong>
            <span id="pontos-acumulados" class="score-main score-positive">0</span>
          </div>
          <button id="reset-button" class="btn-primary">Fechar Semana e Salvar Pontos</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    let tasks = [];
    let rewards = [];
    let saldoAnterior = 0;
    let pontosSemana = 0;
    let pontosAcumulados = 0;
    let taskChecks = {}; // <- guarda checkboxes

    function saveState() {
      localStorage.setItem("plannerState", JSON.stringify({
        saldoAnterior,
        pontosSemana,
        pontosAcumulados,
        rewards,
        taskChecks
      }));
    }

    function loadState() {
      const saved = localStorage.getItem("plannerState");
      if (saved) {
        const state = JSON.parse(saved);
        saldoAnterior = state.saldoAnterior;
        pontosSemana = state.pontosSemana;
        pontosAcumulados = state.pontosAcumulados;
        rewards = state.rewards || [];
        taskChecks = state.taskChecks || {};
      }
    }

    function renderTasks() {
      const tbody = document.getElementById("tasks-table-body");
      tbody.innerHTML = "";
      tasks.forEach((task, taskIndex) => {
        const tr = document.createElement("tr");
        let cells = `<td>${task.name}</td>`;
        for (let day = 0; day < 7; day++) {
          const checkId = `task-${taskIndex}-${day}`;
          const checked = taskChecks[checkId] ? "checked" : "";
          cells += `<td><input type="checkbox" class="task-checkbox" data-id="${checkId}" data-points="${task.points}" ${checked}></td>`;
        }
        cells += `<td>${task.points}</td>`;
        tr.innerHTML = cells;
        tbody.appendChild(tr);

        tr.querySelectorAll(".task-checkbox").forEach(cb => {
          cb.addEventListener("change", () => {
            taskChecks[cb.dataset.id] = cb.checked;
            updateScores();
          });
        });
      });
    }

    function renderRewards() {
      const tbody = document.getElementById("rewards-table-body");
      tbody.innerHTML = "";
      rewards.forEach((reward, index) => {
        if (reward.quantity === undefined) reward.quantity = 0;
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${reward.name}</td>
          <td>${reward.points}</td>
          <td>
            <button class="btn-circle btn-minus">‚àí</button>
            <span class="reward-qty">${reward.quantity}</span>
            <button class="btn-circle btn-plus">+</button>
          </td>
        `;
        tbody.appendChild(tr);

        const minusBtn = tr.querySelector(".btn-minus");
        const plusBtn = tr.querySelector(".btn-plus");
        const qtySpan = tr.querySelector(".reward-qty");

        minusBtn.addEventListener("click", () => {
          if (reward.quantity > 0) {
            reward.quantity--;
            pontosAcumulados += reward.points;
            qtySpan.textContent = reward.quantity;
            updateScores();
          }
        });

        plusBtn.addEventListener("click", () => {
          reward.quantity++;
          pontosAcumulados -= reward.points;
          qtySpan.textContent = reward.quantity;
          updateScores();
        });
      });
    }

    function updateScores() {
      pontosSemana = 0;
      document.querySelectorAll(".task-checkbox:checked").forEach(cb => {
        pontosSemana += parseInt(cb.dataset.points);
      });

      document.getElementById("saldo-anterior").textContent = saldoAnterior;
      document.getElementById("pontos-semana").textContent = `+${pontosSemana}`;
      document.getElementById("pontos-acumulados").textContent = pontosAcumulados + pontosSemana;

      const acumuladoEl = document.getElementById("pontos-acumulados");
      acumuladoEl.classList.toggle("score-negative", (pontosAcumulados + pontosSemana) < 0);
      acumuladoEl.classList.toggle("score-positive", (pontosAcumulados + pontosSemana) >= 0);

      saveState();
    }

    document.getElementById("reset-button").addEventListener("click", () => {
      pontosAcumulados += pontosSemana;
      saldoAnterior = pontosAcumulados;
      pontosSemana = 0;
      taskChecks = {};
      document.querySelectorAll(".task-checkbox").forEach(cb => cb.checked = false);
      rewards.forEach(r => r.quantity = 0);
      renderRewards();
      updateScores();
    });

    async function init() {
      loadState();
      const t = await fetch("tasks.json").then(r => r.json());
      const r = await fetch("rewards.json").then(r => r.json());
      tasks = t;
      if (rewards.length === 0) rewards = r; // se n√£o tinha salvo
      renderTasks();
      renderRewards();
      updateScores();
    }

    init();
  </script>
</body>
</html>
